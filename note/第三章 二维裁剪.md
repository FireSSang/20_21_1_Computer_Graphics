# 第三章 二维裁剪

## 二维点裁剪



## 二维线裁剪

### 裁剪的定义

一般情况下，任何用来消除指定区域内或区域外的图形部分的过程称为裁剪算法（Clipping Algorithm），简称裁剪

裁剪区域一般是一个正则的矩形，其边界位于$XW_{min}$，$XW_{max}$，$YW_{min}$，$YW_{max}$

如果点$P(x,y)$满足下列不等式，则保存该点用于显示
$$
XW_{min} \leq x \leq XW_{max}\\
YW_{min} \leq y \leq YW_{max}
$$
如果上述四个不等式有任何一个不满足，则裁剪掉该点（将不会存储或显示）

应用：用于包含云、海面泡沫、烟或者爆炸等用小圆或小球这样的粒子进行建模的场景

### 裁剪的目的

判断线段是否落在裁剪窗口之内并找到其位于内部的部分

### 裁剪的处理的基础

图元与窗口的求交（耗时）

### 假定条件

- 矩形裁剪窗口

- 待裁剪线段

### 待裁剪线段和窗口的关系

- 线段完全可见
- 显然不可见
- 线段至少有一端点在窗口之外，但非显然不可见

### Cohen-Sutherland算法

#### 编码方法

##### 区域编码：

用窗口四边所在的之前将整个平面分成9个区域，每个区域赋予一个四位的编码$C_{t}C_{b}C_{r}C_{l}$
$$
C_{t}= \begin{cases}1\qquad y>y_{max}\\ 0\qquad else\end{cases}\\
C_{b}= \begin{cases}1\qquad y<y_{min}\\ 0\qquad else\end{cases}\\
C_{r}= \begin{cases}1\qquad x>x_{max}\\ 0\qquad else\end{cases}\\
C_{l}= \begin{cases}1\qquad x<x_{max}\\ 0\qquad else\end{cases}
$$

##### 端点编码：

定义为他所在区域的编码

结论：当线段的两个端点的编码的逻辑“与”非零时，线段是显然不可见的

##### 对于不能判断完全在窗口外或窗口内的线段，则要测试其与窗口的交点

方法：线段与裁剪边界逐个求交

线段与裁剪边界的交点计算可使用斜率截距式方程
$$
y=y_{0}+m(x-x_{0})\\
x=x_{0}+\frac{y-y_{0}}{m}\qquad x=xw_{min};xw_{max}
$$

#### 步骤

1. 判别线段两端点是否都落在窗口内，如果是，则线段完全可见；否则进入第二步
2. 判别线段是否为显然不可见，如果是，则裁剪结束；否则进入第三步
3. 求线段与窗口边延长线的交点，这个交点将线段分为两段，其中一段显然不可见，丢弃。对余下的另一段重新进行第一步、第二步操作

### Nicholl-Lee-Nicholl算法

#### 第一步

编码，假定落在0、4、5

#### 第二步

从$P_{0}$点向窗口地四个角点发出射线，这四条射线和窗口地四条线所在的直线一起将二维平面区域划分为更多的小区域（四类情况）

#### 第三步

确定$P_{1}$所在的区域

方法：比较该线段的斜率和裁剪边界的斜率

#### 第四步

求交点，确定可见部分

### 梁友栋-Barsky算法

已有的快速线段裁剪算法都在计算交点以前进行了更多的测试。梁友栋和Barsky分别提出了参数线裁剪的算法。

#### 参数表示

a

#### 条件

a

##### 改写上式

#### emmmm

- 当$p_{k}=0$时

  - 当$q_{k}<0$时，则线段完全在边界之外，舍弃线段
  - 当$q_{k}\geq 0$时，

- 当$p_{k}<0$时，现炖从裁剪边界K的延长线的外部延伸到内部，当$p_{k}>0$时，反之。

  可以计算线段与边界K的延长线的交点u值
  $$
  u=\frac{q_{k}}{p_{k}}
  $$

#### 对每条直线，可计算出参数$u_{1}$和$u_{2}$，他们定义了裁剪矩形内的部分

- $u_{1}$的值由线段从外到内遇到的矩形边界所决定$(p>0)$



## 非矩形裁剪窗口的线段裁剪